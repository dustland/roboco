
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AgentX - The open-source backbone for building secure, observable, and fully autonomous multi-agent systems.">
      
      
        <meta name="author" content="Dustland Team">
      
      
        <link rel="canonical" href="https://dustland.github.io/agentx/arch/02-state-and-context/">
      
      
        <link rel="prev" href="../01-architecture/">
      
      
        <link rel="next" href="../03-tool-call/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>State and Context - AgentX</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#state-and-context-enabling-complex-long-running-tasks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AgentX" class="md-header__button md-logo" aria-label="AgentX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AgentX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              State and Context
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dustland/agentx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    dustland/agentx
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quickstart/" class="md-tabs__link">
        
  
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../01-architecture/" class="md-tabs__link">
          
  
  
  Design

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../api/" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AgentX" class="md-nav__button md-logo" aria-label="AgentX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AgentX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dustland/agentx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    dustland/agentx
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    State and Context
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    State and Context
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-core-challenges-of-stateful-ai" class="md-nav__link">
    <span class="md-ellipsis">
      1. The Core Challenges of Stateful AI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-architecture-a-two-layered-solution" class="md-nav__link">
    <span class="md-ellipsis">
      2. The Architecture: A Two-Layered Solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. The Architecture: A Two-Layered Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-layer-1-the-workspace-a-durable-version-controlled-record" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. Layer 1: The Workspace - A Durable, Version-Controlled Record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-layer-2-the-memory-system-an-intelligent-knowledge-base" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. Layer 2: The Memory System - An Intelligent Knowledge Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-example-workflow-revisited-solving-problems-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      3. Example Workflow Revisited: Solving Problems in Practice
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-system-design-and-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      4. System Design and Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. System Design and Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-workspace-design" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Workspace Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-memory-system-design" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Memory System Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-system-architecture-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. System Architecture Diagram
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-detailed-implementation-blueprint" class="md-nav__link">
    <span class="md-ellipsis">
      5. Detailed Implementation Blueprint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Detailed Implementation Blueprint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-memory-object-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Memory Object Data Models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-core-component-interfaces-python-like-pseudocode" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Core Component Interfaces (Python-like Pseudocode)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-key-logic-flows" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Key Logic Flows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-tool-call/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tool Calls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Communication
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-core-challenges-of-stateful-ai" class="md-nav__link">
    <span class="md-ellipsis">
      1. The Core Challenges of Stateful AI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-architecture-a-two-layered-solution" class="md-nav__link">
    <span class="md-ellipsis">
      2. The Architecture: A Two-Layered Solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. The Architecture: A Two-Layered Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-layer-1-the-workspace-a-durable-version-controlled-record" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. Layer 1: The Workspace - A Durable, Version-Controlled Record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-layer-2-the-memory-system-an-intelligent-knowledge-base" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. Layer 2: The Memory System - An Intelligent Knowledge Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-example-workflow-revisited-solving-problems-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      3. Example Workflow Revisited: Solving Problems in Practice
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-system-design-and-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      4. System Design and Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. System Design and Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-workspace-design" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Workspace Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-memory-system-design" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Memory System Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-system-architecture-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. System Architecture Diagram
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-detailed-implementation-blueprint" class="md-nav__link">
    <span class="md-ellipsis">
      5. Detailed Implementation Blueprint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Detailed Implementation Blueprint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-memory-object-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Memory Object Data Models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-core-component-interfaces-python-like-pseudocode" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Core Component Interfaces (Python-like Pseudocode)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-key-logic-flows" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Key Logic Flows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="state-and-context-enabling-complex-long-running-tasks">State and Context: Enabling Complex, Long-Running Tasks</h1>
<p>A key challenge in building autonomous AI systems is managing state. For an agent to perform complex, multi-step tasks like writing a novel or developing a software project, it needs a reliable, long-term memory of its work. This document outlines AgentX's state and context architecture, which is designed specifically to address the hard problems of contextual understanding in large-scale tasks.</p>
<h2 id="1-the-core-challenges-of-stateful-ai">1. The Core Challenges of Stateful AI</h2>
<p>Before detailing the architecture, it's crucial to understand the specific challenges AgentX aims to solve. Effective state and context management must address the following:</p>
<ul>
<li>
<p>Navigating Large and Complex Workspaces: A significant project, whether it's a codebase or a research archive, can contain hundreds or thousands of files. An agent cannot simply "list all files" and be effective. It needs a way to understand the project's structure, identify key artifacts, and navigate the workspace intelligently without being overwhelmed.</p>
</li>
<li>
<p>Processing Long-Form Content: A single artifact, like a legacy source code file or a detailed technical paper, can be thousands of lines long—far exceeding the context window of any LLM. An agent tasked with refactoring a large file or summarizing a dense document cannot simply "read the file." It needs a mechanism to process content in a way that preserves the overall structure and meaning.</p>
</li>
<li>
<p>Contextual Scoping and Filtering: Agents often start with a vast pool of raw data, such as gigabytes of financial reports for a market analysis. The critical challenge is to narrow down this "firehose of information" to a small, relevant subset of data that is actually valuable for the task at hand. An agent writing a research summary needs to intelligently select its sources, not just process all of them.</p>
</li>
<li>
<p>Balancing Performance with Quality: While quality is paramount, system performance cannot be ignored. A system that is perfectly thorough but takes hours to respond is impractical. We need an architecture that provides high-quality, relevant context to the agent in a timely manner, making smart trade-offs between exhaustive search and responsive interaction.</p>
</li>
<li>
<p>Automated Quality Assessment: How does the system know if a generated artifact is "good"? For code, this could mean passing linting checks, compiling successfully, or passing unit tests. For a document, it might mean checking for spelling errors or grammatical correctness. The system needs a mechanism to automatically assess the quality of its own outputs to guide the iterative process.</p>
</li>
</ul>
<h2 id="2-the-architecture-a-two-layered-solution">2. The Architecture: A Two-Layered Solution</h2>
<p>AgentX addresses these challenges with a two-layered architecture: The <strong>Workspace</strong> provides a durable, comprehensive record of the task, while the <strong>Memory System</strong> provides the intelligent interface for navigating and understanding it.</p>
<h3 id="21-layer-1-the-workspace-a-durable-version-controlled-record">2.1. Layer 1: The Workspace - A Durable, Version-Controlled Record</h3>
<p>The <strong>Workspace</strong> is the single source of truth for a task. By creating a version-controlled directory containing every message, artifact, and state change, it directly addresses the need for a complete and traceable history.</p>
<ul>
<li><strong>Solution for Navigating Large Workspaces</strong>: While the Workspace stores everything, agents interact with it via tools. Tools like <code>list_directory</code> combined with an agent's reasoning allow it to explore the structure of the workspace step-by-step, rather than being flooded with a list of thousands of files at once.</li>
<li><strong>Foundation for Quality Assessment</strong>: By providing a stable location for artifacts (e.g., <code>main.py</code>), the Workspace enables the creation of quality assessment tools. A <code>linting_tool</code> or <code>build_tool</code> can be pointed at artifacts in the Workspace to check their integrity, providing structured feedback that the agent can act upon.</li>
</ul>
<h3 id="22-layer-2-the-memory-system-an-intelligent-knowledge-base">2.2. Layer 2: The Memory System - An Intelligent Knowledge Base</h3>
<p>The <strong>Memory System</strong> is not merely a passive query layer but a sophisticated, multi-faceted knowledge base that sits on top of the Workspace. It proactively transforms the raw, version-controlled data into actionable intelligence for the agents. Its responsibilities are threefold:</p>
<ul>
<li>
<p><strong>1. Semantic Indexing and Retrieval (Cold Data Querying)</strong>: This is the foundational capability. The Memory System indexes the entire contents of the Workspace, allowing agents to perform fast, semantic searches over vast amounts of "cold" data. This solves the problem of processing long-form content by allowing an agent to find relevant snippets (e.g., <em>"Find functions in services.py related to payment processing"</em>) without loading entire files into its context window.</p>
</li>
<li>
<p><strong>2. Intelligent Summarization and Abstraction</strong>: The Memory System can synthesize information to provide high-level, abstract summaries on demand. For example, an agent can ask it to generate a "virtual README" for a directory it has never seen before, or to summarize the key decisions from a long conversation history. This allows agents to quickly orient themselves in complex environments without needing to read every single line of source material.</p>
</li>
<li>
<p><strong>3. Proactive Knowledge Synthesis (Rules, Constraints, and Hot-Issues)</strong>: This is the system's most advanced function, where it acts as a true cognitive partner. It goes beyond analyzing workspace data to internalize user instructions and preferences, creating a set of rules and guardrails for the agent's behavior.</p>
</li>
<li><strong>Capturing User Constraints</strong>: The system is designed to capture and enforce high-level user constraints that persist across interactions. If a user states, <em>"When writing about Tesla's future, never mention Elon Musk,"</em> the Memory System records this as a core project requirement. This rule is then used to guide content generation and validation, ensuring the final output adheres to the user's explicit directive.</li>
<li><strong>Learning from Feedback</strong>: It learns from iterative feedback to codify developer or user preferences. When a developer says, <em>"You should never create a <code>requirements.txt</code> file; use <code>pyproject.toml</code> instead,"</em> the Memory System flags this as a permanent rule for all future file operations in that workspace. This prevents the agent from repeating mistakes or asking redundant questions.</li>
<li><strong>Tracking Hot-Issues</strong>: It maintains a "working memory" of transient problems. For instance, if a unit test fails, the Memory System flags it as a "hot issue" that is automatically surfaced in the agent's context on every subsequent step until it is resolved. This prevents critical blockers from being lost in a long history.</li>
</ul>
<h2 id="3-example-workflow-revisited-solving-problems-in-practice">3. Example Workflow Revisited: Solving Problems in Practice</h2>
<p>Consider the workflow of an agent tasked with adding a feature to a large, existing codebase, but this time using the full power of the intelligent Memory System.</p>
<ol>
<li><strong>Challenge - Capturing Constraints</strong>: The user starts by saying, <em>"I'm getting a strange bug related to caching, so for now, please add a <code>@disable_cache</code> decorator to any new data-fetching functions you write."</em> The Memory System logs <strong><code>Rule: Must add '@disable_cache' to new data-fetching functions.</code></strong></li>
<li><strong>Challenge - Navigating the Workspace</strong>: The agent doesn't know the code structure. It asks, <strong><code>summarize_directory_purpose(path='/src/api')</code></strong>. The Memory System synthesizes a description, and also surfaces the active rule about caching.</li>
<li><strong>Challenge - Processing Long-Form Content</strong>: The agent identifies a large <code>services.py</code> file and uses <strong><code>search_memory(query='Find functions in services.py related to user data')</code></strong> to get the relevant snippets.</li>
<li><strong>Challenge - Quality Assessment &amp; Hot-Issue Tracking</strong>: After writing a new function to the file, the agent calls <code>run_unit_tests_tool()</code>. The test fails. The Memory System detects this and creates a high-priority "hot issue": <strong><code>Critical: Unit test 'test_new_feature' is failing.</code></strong></li>
<li><strong>Focused Iteration</strong>: On the agent's next reasoning cycle, two items are injected into its context: the <strong>Rule</strong> about the decorator and the <strong>Hot-Issue</strong> about the failing test. The agent sees the code it wrote is missing the decorator. It adds it, confident this will fix the issue.</li>
<li><strong>Resolution</strong>: The agent runs the tests again. They pass. The Memory System sees the success event, automatically resolves and removes the "hot issue," and the task proceeds. The rule about the decorator remains active.</li>
</ol>
<p>This workflow, grounded in a state and context architecture powered by an intelligent knowledge base, demonstrates how AgentX provides a practical and scalable solution to the core challenges of building sophisticated, stateful AI agents.</p>
<h2 id="4-system-design-and-implementation">4. System Design and Implementation</h2>
<p>This section details the technical implementation of the Workspace and Memory System, explaining how the conceptual goals are achieved.</p>
<h3 id="41-workspace-design">4.1. Workspace Design</h3>
<p>The Workspace is not a conceptual space but a physical directory on the filesystem, managed by a <code>GitStorage</code> backend.</p>
<ul>
<li><strong>Core Technology</strong>: Every task workspace is a Git repository. This provides a robust, built-in mechanism for versioning, change tracking, and durability.</li>
<li><strong>Directory Structure</strong>:</li>
<li><code>artifacts/</code>: This subdirectory contains all the files created or modified by agents (e.g., source code, documents, data files). This is the tangible work product of the system.</li>
<li><code>history.jsonl</code>: This file is the immutable, ground-truth log of the task. Every single event—every user message, agent thought process, tool call, and tool result—is appended to this file as a JSON object. The system uses this for auditing, debugging, and for rebuilding the state of the Memory system if needed.</li>
<li><strong>Interaction Model</strong>: Agents do not directly execute <code>git</code> commands. They interact with the workspace via a clean abstraction layer: the <code>Storage</code> tools (<code>read_file</code>, <code>write_file</code>, <code>list_directory</code>). After an agent successfully executes a <code>write_file</code> operation, the <code>GitStorage</code> backend automatically commits the change to the repository with a descriptive message, creating a precise, versioned history of the work.</li>
</ul>
<h3 id="42-memory-system-design">4.2. Memory System Design</h3>
<p>The Memory System is an active component that hooks into the core event loop of the system to process information and provide context.</p>
<ul>
<li>
<p><strong>Core Components</strong>:</p>
</li>
<li>
<p><strong>Event Bus Listener</strong>: The Memory System subscribes to the central <code>EventBus</code>. This allows it to receive a real-time stream of all events happening within the system (e.g., <code>UserMessageSent</code>, <code>ToolCallExecuted</code>, <code>AgentThoughtProcess</code>).</p>
</li>
<li><strong>Pluggable Memory Backend</strong>: This is the storage engine for memory objects. It can be a vector database (like <code>Mem0</code>) for semantic search, a relational database, or a simple file-based store. It's responsible for persisting and retrieving the memory objects created by the Synthesis Engine.</li>
<li>
<p><strong>Synthesis Engine</strong>: This is the logical core of the Memory System. It's a service that contains the business logic for creating and managing memories. It listens to events from the Event Bus and decides what actions to take.</p>
</li>
<li>
<p><strong>Data and Control Flow</strong>:</p>
</li>
<li><strong>Indexing Content</strong>: When the Event Bus Listener sees a <code>ToolCallExecuted</code> event for a <code>write_file</code> operation, it triggers the Synthesis Engine. The engine, in turn, takes the content of the written file and instructs the Memory Backend to index it for future semantic search.</li>
<li><strong>Creating Rules and Hot-Issues</strong>:<ul>
<li>When a <code>UserMessageSent</code> event occurs, the Synthesis Engine can make an LLM call to analyze the text for imperative commands or constraints. If a constraint like <em>"Don't use <code>requirements.txt</code>"</em> is found, it creates a <code>CONSTRAINT</code> memory object and saves it to the backend.</li>
<li>When a <code>ToolCallExecuted</code> event occurs with a <code>status: FAILED</code> and is identified as a critical failure (e.g., from a test runner tool), the Synthesis Engine creates a <code>HOT_ISSUE</code> memory object.</li>
</ul>
</li>
<li><strong>Injecting Context</strong>: This is the critical retrieval step. Before the <code>Orchestrator</code> runs an agent's reasoning cycle, it makes a call to the Memory System: <code>memory.get_relevant_context(last_user_message)</code>. The Memory System's implementation of this method is designed to <em>always</em> retrieve all active <code>CONSTRAINT</code> and <code>HOT_ISSUE</code> objects from its backend, in addition to performing a semantic search on the user's message. This combined payload is what gets inserted into the agent's prompt, ensuring it is always aware of the most critical rules and problems.</li>
</ul>
<h3 id="43-system-architecture-diagram">4.3. System Architecture Diagram</h3>
<p>The following diagram illustrates the data flow for how the Memory System processes events and provides context back to the agent.</p>
<pre class="mermaid"><code>graph TD
    subgraph "External Systems"
        User
        Orchestrator
        EventBus
    end

    subgraph "Memory System"
        MSL[Event Bus Listener]
        MSE[Synthesis Engine &lt;br/&gt; (LLM-Powered Logic)]
        MSB[Memory Backend &lt;br/&gt; (Vector DB + KV Store)]
    end

    User -- "Sends Message" --&gt; EventBus
    Orchestrator -- "Executes Tool" --&gt; EventBus

    EventBus -- "1. Receives Events &lt;br/&gt; (UserMessage, ToolResult)" --&gt; MSL
    MSL -- "2. Forwards Events" --&gt; MSE

    MSE -- "3a. Analyzes for Constraints" --&gt; MSE
    MSE -- "3b. Analyzes for Hot-Issues" --&gt; MSE
    MSE -- "3c. Extracts Content for Indexing" --&gt; MSE

    MSE -- "4. Persists Memories" --&gt; MSB
    MSB -- "Stores: &lt;br/&gt; - Constraints &lt;br/&gt; - Hot-Issues &lt;br/&gt; - Vector Embeddings" --&gt; MSB

    Orchestrator -- "5. get_relevant_context()" --&gt; MSE
    MSE -- "6. Queries Backend" --&gt; MSB
    MSB -- "7. Returns Memories" --&gt; MSE
    MSE -- "8. Injects into Agent Prompt" --&gt; Orchestrator</code></pre>
<h2 id="5-detailed-implementation-blueprint">5. Detailed Implementation Blueprint</h2>
<p>This section provides implementation-level details for the key components.</p>
<h3 id="51-memory-object-data-models">5.1. Memory Object Data Models</h3>
<p>The system uses strongly-typed data models to represent different types of memories. These can be implemented as Pydantic models or similar data classes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">uuid4</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Memory</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CONSTRAINT&quot;</span><span class="p">,</span> <span class="s2">&quot;HOT_ISSUE&quot;</span><span class="p">,</span> <span class="s2">&quot;DOCUMENT_CHUNK&quot;</span><span class="p">]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">source_event_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Used to resolve hot-issues</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">Constraint</span><span class="p">(</span><span class="n">Memory</span><span class="p">):</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CONSTRAINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CONSTRAINT&quot;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="c1"># e.g., &quot;Do not use requirements.txt&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">HotIssue</span><span class="p">(</span><span class="n">Memory</span><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;HOT_ISSUE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;HOT_ISSUE&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="c1"># e.g., &quot;Unit test &#39;test_payment_flow&#39; is failing.&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocumentChunk</span><span class="p">(</span><span class="n">Memory</span><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;DOCUMENT_CHUNK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DOCUMENT_CHUNK&quot;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">source_file_path</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="c1"># e.g., A chunk of text from a file.</span>
</code></pre></div>
<h3 id="52-core-component-interfaces-python-like-pseudocode">5.2. Core Component Interfaces (Python-like Pseudocode)</h3>
<p>These interfaces define the contracts between the major components.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># --- Backend Interface ---</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">MemoryBackend</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Memory</span><span class="p">]):</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Persists a list of memory objects.&quot;&quot;&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="k">pass</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_active_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Memory</span><span class="p">]:</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns all active CONSTRAINT and HOT_ISSUE memories.&quot;&quot;&quot;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>        <span class="k">pass</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DocumentChunk</span><span class="p">]:</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs semantic search over document chunks.&quot;&quot;&quot;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>        <span class="k">pass</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="c1"># --- Main System Interface ---</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">MemorySystem</span><span class="p">:</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="n">MemoryBackend</span><span class="p">):</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relevant_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_user_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The primary method called by the Orchestrator.&quot;&quot;&quot;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>        <span class="c1"># Implementation logic described in 5.3</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>        <span class="k">pass</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">):</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The primary event handler called by the Event Bus Listener.&quot;&quot;&quot;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>        <span class="c1"># Implementation logic described in 5.3</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="k">pass</span>
</code></pre></div>
<h3 id="53-key-logic-flows">5.3. Key Logic Flows</h3>
<p>This section details the step-by-step logic within the <code>MemorySystem</code>.</p>
<p><strong>A. Event Handling (<code>on_event</code> logic):</strong></p>
<ol>
<li><strong>Receive Event</strong>: The <code>on_event</code> method is triggered by the Event Bus Listener.</li>
<li><strong>Route by Event Type</strong>:<ul>
<li><strong>If <code>event.type == "UserMessageSent"</code></strong>:</li>
<li>Construct an LLM prompt: <code>"""Does the following user message contain a persistent rule, constraint, or preference for an AI assistant? If so, state the rule clearly in a single imperative sentence. If not, respond with 'N/A'.\n\nUser Message: "{event.text}"</code>"""</li>
<li>Call the LLM. If the response is not "N/A", create a <code>Constraint</code> memory object with the LLM's response as the content and save it via <code>backend.save_memories()</code>.</li>
<li><strong>If <code>event.type == "ToolCallExecuted"</code> and <code>event.tool_name in ["run_tests", "linter"]</code> and <code>event.status == "FAILED"</code></strong>:</li>
<li>Create a <code>HotIssue</code> memory object.</li>
<li><code>content</code> should be a summary of the failure (e.g., <code>f"Tool '{event.tool_name}' failed: {event.result_summary}"</code>).</li>
<li>Save it via <code>backend.save_memories()</code>.</li>
<li><strong>If <code>event.type == "ToolCallExecuted"</code> and <code>event.status == "SUCCESS"</code> and a related <code>HotIssue</code> exists</strong>:</li>
<li>Retrieve the related <code>HotIssue</code>.</li>
<li>Set <code>is_active = False</code> on the <code>HotIssue</code> object.</li>
<li>Save the updated memory object.</li>
<li><strong>If <code>event.type == "ToolCallExecuted"</code> and <code>event.tool_name == "write_file"</code></strong>:</li>
<li>Read the content of the written file.</li>
<li>Chunk the content into manageable pieces (e.g., by paragraph or function definition).</li>
<li>Create a <code>DocumentChunk</code> object for each piece.</li>
<li>Save them via <code>backend.save_memories()</code>.</li>
</ul>
</li>
</ol>
<p><strong>B. Context Retrieval (<code>get_relevant_context</code> logic):</strong></p>
<ol>
<li><strong>Fetch Active Rules</strong>: Call <code>backend.get_active_rules()</code> to get all current <code>Constraint</code> and <code>HotIssue</code> objects.</li>
<li><strong>Perform Semantic Search</strong>: Call <code>backend.search_documents(query=last_user_message, top_k=5)</code> to get the most relevant document chunks.</li>
<li>
<p><strong>Format for Prompt</strong>: Combine the retrieved memories into a structured string to be injected into the agent's prompt.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>CONTEXT:
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>---
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>ACTIVE RULES AND ISSUES:
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>- [Constraint] Do not use requirements.txt.
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>- [Hot Issue] Unit test &#39;test_payment_flow&#39; is failing.
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>RELEVANT DOCUMENT SNIPPETS:
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>- [Source: src/utils.py] def payment_flow(): ...
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>---
</code></pre></div>
</li>
<li>
<p>Return the formatted string.</p>
</li>
</ol>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.instant", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>